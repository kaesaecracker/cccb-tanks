<!doctype html>
<meta charset="utf-8">
<title>Tanks</title>
<script>
  var connection = new WebSocket('ws://172.23.42.133:8001')
  connection.binaryType = "blob"

  var controls = {
    37: "left",
    38: "up",
    39: "right",
    40: "down",
    32: "space",
    87: "up", // 'w'
    65: "left", // 'a'
    83: "down", // 's'
    68: "right", // 'd'
  }


  function start(){
    window.onkeyup = function(event){
      if(controls[event.keyCode]){
        connection.send(JSON.stringify({
          type: 'input-off',
          value: controls[event.keyCode]
        }))
      }
    }
    window.onkeydown=function(event){
      console.log(event.keyCode)
      if(controls[event.keyCode]){
        connection.send(JSON.stringify({
          type: 'input-on',
          value: controls[event.keyCode]
        }))
      }
    }
  }

  connection.onmessage = function(message){
    console.log("message", message)
  }

  connection.onopen = function() {
    var name = ""

    while(!name)
      name = prompt("Player Name")

    connection.send(JSON.stringify({
      type: 'name',
      value: name
    }))
    start()
  }
</script>